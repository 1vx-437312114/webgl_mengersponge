<!DOCTYPE html><html lang=en><title>webgl raymarching - shader</title><meta charset=utf-8><meta name=viewport content="width=device-width,user-scalable=no,minimum-scale=1,maximum-scale=1"><style>body{color:#fff;font-family:sans-serif;font-size:14px;text-align:center;font-weight:700;background-color:#000;margin:0;overflow:hidden}canvas{display:block;position:absolute;top:0;left:0;right:0;bottom:0;margin:auto}#info{position:absolute;top:10px;width:100%;padding:5px}a{color:#fff}#oldie a{color:#da0}</style><body><noscript><hr><h3>This page requires Javascript and a web browser that supports WebGL</h3><hr></noscript><div id=container></div><div id=info><font color=red>webgl</font> raymarching demo <a href=https://en.wikipedia.org/wiki/Menger_sponge target=_blank>(menger sponge)</a> by <font color=green>1vx_37312114</font></div><script src=js/dat.gui.min.js></script><script src=js/three.min.js></script><script src=js/Detector.js></script><script src=js/stats.min.js></script><script id=vertexShader type=x-shader/x-vertex>void main()	{gl_Position = vec4( position, 1.0 );}</script><script id=fragmentShader type=x-shader/x-fragment>precision mediump float;uniform vec3 iResolution;uniform float iGlobalTime;uniform bool point_rotation;
		float f;const int y=5;const float v=3.;vec3 m=vec3(1.,1.,1.);mat3 n=mat3(1,0,0,0,1,0,0,0,1);
		vec3 s(vec3 v){vec3 f=vec3(0.,-1.,0.),m=vec3(1.6,1.8,2.2);float y=max(dot(v,f),0.),z=pow(1.-max(v.y,0.),6.);
		vec3 i=mix(vec3(.1,.2,.3),vec3(.32,.32,.32),z);i+=m*y*y*.25+m*min(pow(y,800.)*1.5,.3);
		return clamp(i,vec3(0.,0.,0.),vec3(1.,1.,1.));}float p(vec3 i){float c=1e+20;for(int r=0;r<y;r++){
		if(point_rotation){float z=6.28319*sin(iGlobalTime*.002),p=sin(z),d=cos(z);
		mat3 s=mat3(1.,0.,0.,0.,d,p,0.,-p,d),x=mat3(d,0.,-p,0.,1.,0.,p,0.,d),l=mat3(d,p,0.,-p,d,0.,0.,0.,1.);i=i*s*x*l;}
		i=abs(i);if(i.x<i.y)i.xy=i.yx;if(i.x<i.z)i.xz=i.zx;if(i.y<i.z)i.zy=i.yz;i.z-=.5*m.z*(v-1.)/v;i.z=-abs(i.z);
		i.z+=.5*m.z*(v-1.)/v;i*=n;i*=v;i.x-=m.x*(v-1.);i.y-=m.y*(v-1.);c=min(c,length(i));}vec3 d=abs(i)-vec3(1.,1.,1.);
		float r=min(max(d.x,max(d.y,d.z)),0.)+length(max(d,0.));r*=pow(v,float(-y));f=c;return r;}float p(in vec3 v,in vec3 i)
		{const int f=256;const float y=100.,z=.0003;float c=0.;for(int r=0;r<f;r++){vec3 d=v+i*c;float m=p(d);if(c>y||m<z)break;
		c+=m;}if(c<y)return c;else return-1.;}float s(vec3 v,vec3 m){vec3 i=v+.001*m,d=i,z=m;const float f=2.;float c=1.,y=0.;
		for(int r=0;r<100;r++){float n=p(d+z*y);if(n<.0001)return 0.;if(y>100.)break;c=min(c,f*n/y);y+=n;}return c;}vec3 t(vec3 v)
		{const float i=.001;vec3 y=vec3(i,0.,0.),z=vec3(0.,i,0.),d=vec3(0.,0.,i);float c=p(v+y)-p(v-y),f=p(v+z)-p(v-z),m=p(v+d)-p(v-d);
		vec3 r=normalize(vec3(c,f,m));return r;}float t(vec3 v,vec3 y){const float i=5.,c=.005;float f=0.;for(float r=0.;r<10.;r+=1.)
		{float m=1./pow(2.,r);vec3 d=v+y*r*c;f+=m*(r*c-p(d));}return 1.-i*f;}vec3 x(vec2 i){const vec3 v=vec3(0.,.1,0.),d=vec3(.577,.577,-.577),c=vec3(-.707,0.,.707);
		const float y=1.2;float r=iResolution.x/iResolution.y;vec2 m=-1.+2.*i.xy/iResolution.xy,z=m*vec2(r,1.);float n=iGlobalTime*.05,x=2.3+.1*cos(.29*n);
		vec3 a=vec3(x*cos(.33*n),.8*x*sin(.37*n),x*sin(.31*n));float l=.5*cos(.1*n);
		vec3 b=vec3(sin(l),cos(l),0.),g=normalize(v-a),e=normalize(cross(g,b)),o=normalize(cross(e,g)),u=normalize(z.x*o+z.y*e+y*g),k,w;
		float R=p(a,u);if(R<0.)k=s(u);else{vec3 T=a+R*u,G=t(T),h=normalize(d-u),F=reflect(u,G);float C=.1*log(f);
		w=vec3(C,C,0)*abs(T);k=vec3(.7,.2,.2);k=mix(k,vec3(1.,.5,.2),sqrt(w.y));k=mix(k,vec3(1.,1.,1.),w.x);
		float q=clamp(dot(d,G),0.,1.),Z=clamp(.5+.5*dot(c,G),0.,1.),Y=.05*t(T,G),X=s(T,d),W=.04+.96*pow(clamp(1.-dot(-u,G),0.,1.),5.),V=pow(clamp(dot(G,h),0.,1.),12.)*q*W*8.;
		vec3 U=1.5*vec3(.15,.2,.23)*(.7+.3*G.y)*(.2+.8*Y);U+=3.5*vec3(1.,.9,.6)*q*X;U+=4.1*vec3(.14,.14,.14)*Z*Y;
		U+=2.*vec3(1.,1.,1.)*V*X*Y;U+=2.*vec3(.2,.3,.4)*(.02+.98*Y);U+=2.*vec3(.8,.9,1.)*smoothstep(0.,1.,F.y)*Y;k*=U;k+=V*Y*X;}
		k=sqrt(k);return k;}void main(){vec3 v;v=x(gl_FragCoord.xy);gl_FragColor=vec4(v,1.);}</script><script>function init(){container=document.getElementById("container"),camera=new THREE.Camera,camera.position.z=1,scene=new THREE.Scene;var e=new THREE.PlaneBufferGeometry(2,2);uniforms={iGlobalTime:{value:0},iResolution:{value:new THREE.Vector3},point_rotation:{value:1}};var n=new THREE.ShaderMaterial({uniforms:uniforms,vertexShader:document.getElementById("vertexShader").textContent,fragmentShader:document.getElementById("fragmentShader").textContent}),t=new THREE.Mesh(e,n);scene.add(t),renderer=new THREE.WebGLRenderer,renderer.setPixelRatio(window.devicePixelRatio),renderer.setSize(800,800),canvas=renderer.domElement,window.addEventListener("resize",onWindowResize),document.body.appendChild(canvas);var i=new dat.GUI;i.add(config,"point_rotation").name("point iteration"),i.add(config,"resolution",["256","512","800","fullscreen"]).name("Resolution").onChange(function(e){"full"!==e&&(canvas.width=e,canvas.height=e),onWindowResize()}),onWindowResize(),stats=new Stats,container.appendChild(stats.dom),window.addEventListener("resize",onWindowResize,!1)}function onWindowResize(e){"fullscreen"===config.resolution&&(canvas.width=window.innerWidth,canvas.height=window.innerHeight),renderer.setSize(canvas.width,canvas.height),uniforms.iResolution.value.x=renderer.domElement.width,uniforms.iResolution.value.y=renderer.domElement.height,uniforms.iResolution.value.z=0}function render(){requestAnimationFrame(render),1==config.point_rotation?uniforms.point_rotation.value=1:uniforms.point_rotation.value=0,uniforms.iGlobalTime.value+=.1,renderer.render(scene,camera),stats.update()}Detector.webgl||Detector.addGetWebGLMessage();var container,stats,camera,scene,renderer,uniforms,canvas,config={point_rotation:!0,resolution:"800"};init(),render()</script>
